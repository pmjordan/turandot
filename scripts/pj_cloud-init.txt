#cloud-config
debug:
  verbose: true
package_upgrade: false
packages:
  - git
  - jq
  - pigz
  - podman
  - helm
write_files:
  - owner: azureuser:azureuser
    path: /home/azureuser/startup.sh
    content: |
      #!/bin/sh
      echo "this has been written via cloud-init" + $(date) >> ~/logs.txt
    permissions: '0744'
groups:
  - turandot: [azureuser]
runcmd:
  - git clone https://github.com/tmforum-oda/oda-canvas-charts
  - /opt/oda-canvas-charts/install_canvas.sh
  - sudo chown azureuser:azureuser /home/azureuser
  - sudo chown azureuser:azureuser /home/azureuser/startup.sh
  - /home/azureuser/startup.sh
  - cd /opt
  - git clone --branch mymaster --single-branch https://github.com/pmjordan/turandot.git
  - chown -R root:turandot /opt/turandot
  - chmod -R g+w /opt/turandot
  - /opt/turandot/scripts/pj_install.sh
  - mkdir -p -m 775 /Depot/Temporary
  - chown -R :turandot /Depot/Temporary
  - usermod -a -G turandot azureuser

final_message: "The system is finally up, after $UPTIME seconds."